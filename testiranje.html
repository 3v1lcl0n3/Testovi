<html lang="en">
  <head>
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">
    <link  rel="stylesheet" href="css/style_dva.css">
	<style>
	#smartguide-1251422910{
	visibility: hidden;
	}
	
	#Task_form,.tekst{
	touch-action: none;
	}
	
	.tekst,#id{
	-webkit-user-select: none;
	-khtml-user-select: none;
	-moz-user-select: none;
	-ms-user-select: none;
	-o-user-select: none;
	user-select: none;
	
	}
	
	#selekcija {
	background: tomato;
	color:white;
	}
	
	.menu {
  position: absolute;
  width: 200px;
  padding: 2px;
  margin: 0;
  border: 1px solid #bbb;
  background: #eee;
  background: -webkit-linear-gradient(to bottom, #fff 0%, #e5e5e5 100px, #e5e5e5 100%);
  background: linear-gradient(to bottom, #fff 0%, #e5e5e5 100px, #e5e5e5 100%);
  z-index: 100;
  border-radius: 3px;
  box-shadow: 1px 1px 4px rgba(0,0,0,.2);
  opacity: 0;
  -webkit-transform: translate(0, 15px) scale(.95);
  transform: translate(0, 15px) scale(.95);
  transition: transform 0.1s ease-out, opacity 0.1s ease-out;
  pointer-events: none;
}

.menu-item {
  display: block;
  position: relative;
  margin: 0;
  padding: 0;
  white-space: nowrap;
}

.menu-btn {
  background: none;
  line-height: normal;
  overflow: visible;
  -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  display: block;
  width: 100%;
  color: #444;
  font-family: 'Roboto', sans-serif;
  font-size: 13px;
  text-align: left;
  cursor: pointer;
  border: 1px solid transparent;
  white-space: nowrap;
  padding: 6px 8px;
  border-radius: 3px;
}
 .menu-btn::-moz-focus-inner, .menu-btn::-moz-focus-inner {
 border: 0;
 padding: 0;
}

.menu-text { margin-left: 25px; }

.menu-btn .fa {
  position: absolute;
  left: 8px;
  top: 50%;
  -webkit-transform: translateY(-50%);
  transform: translateY(-50%);
}

.menu-item:hover > .menu-btn {
  color: #fff;
  outline: none;
  background-color: #2E3940;
  background: -webkit-linear-gradient(to bottom, #5D6D79, #2E3940);
  background: linear-gradient(to bottom, #5D6D79, #2E3940);
  border: 1px solid #2E3940;
}

.menu-item.disabled {
  opacity: .5;
  pointer-events: none;
}

.menu-item.disabled .menu-btn { cursor: default; }

.menu-separator {
  display: block;
  margin: 7px 5px;
  height: 1px;
  border-bottom: 1px solid #fff;
  background-color: #aaa;
}

.menu-item.submenu::after {
  content: "";
  position: absolute;
  right: 6px;
  top: 50%;
  -webkit-transform: translateY(-50%);
  transform: translateY(-50%);
  border: 5px solid transparent;
  border-left-color: #808080;
}

.menu-item.submenu:hover::after { border-left-color: #fff; }

.menu .menu {
  top: 4px;
  left: 99%;
}

.show-menu, .menu-item:hover > .menu {
  opacity: 1;
  -webkit-transform: translate(0, 0) scale(1);
  transform: translate(0, 0) scale(1);
  pointer-events: auto;
}

.menu-item:hover > .menu {
  -webkit-transition-delay: 100ms;
  transition-delay: 300ms;
}
	</style>
	
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
	<meta name="apple-mobile-web-app-capable" content="yes">
	<meta name="mobile-web-app-capable" content="yes">
	<meta name="HandheldFriendly" content="true"/>
	<title>Keyboard Experiment</title>
	<link rel="stylesheet" href="./dist/myscript.min.css"/>
	<link rel="stylesheet" href="./examples/examples.css">
	<script src="https://code.jquery.com/pep/0.4.3/pep.js"></script>
	<script type="text/javascript" src="./dist/myscript.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/1.3.8/FileSaver.js"></script> <!-- File saver skripta -->
	<script src = "js/login_script.js"></script> <!--Moja skripta u kojoj je save (ime funkcije: downloadResults(var string) -->
	<script src = "js/jquery-3.4.1.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-contextmenu/2.6.4/jquery.contextMenu.min.js"></script>
  </head>
  
  <body>	
  <div class = "container" id="container">
  <menu class="menu">
  <li class="menu-item">
    <button type="button" class="menu-btn"> <i class="fa fa-folder-open"></i> <span class="menu-text">Open</span> </button>
  </li>
  <li class="menu-item disabled">
    <button type="button" class="menu-btn"> <span class="menu-text">Open in New Window</span> </button>
  </li>
  <li class="menu-separator"></li>
  <li class="menu-item">
    <button type="button" class="menu-btn" onClick="kopiraj()"> <i class="fa fa-reply"></i> <span class="menu-text">Copy</span> </button>
  </li>
  <li class="menu-item">
    <button type="button" class="menu-btn" onClick="pasteaj()"> <i class="fa fa-star"></i> <span class="menu-text">Paste</span> </button>
  </li>
  <li class="menu-item submenu">
    <button type="button" class="menu-btn"> <i class="fa fa-users"></i> <span class="menu-text">Social</span> </button>
    <menu class="menu">
      <li class="menu-item">
        <button type="button" class="menu-btn"> <i class="fa fa-comment"></i> <span class="menu-text">Comment</span> </button>
      </li>
      <li class="menu-item submenu">
        <button type="button" class="menu-btn"> <i class="fa fa-share"></i> <span class="menu-text">Share</span> </button>
        <menu class="menu">
          <li class="menu-item">
            <button type="button" class="menu-btn"> <i class="fa fa-twitter"></i> <span class="menu-text">Twitter</span> </button>
          </li>
          <li class="menu-item">
            <button type="button" class="menu-btn"> <i class="fa fa-facebook-official"></i> <span class="menu-text">Facebook</span> </button>
          </li>
          <li class="menu-item">
            <button type="button" class="menu-btn"> <i class="fa fa-google-plus"></i> <span class="menu-text">Google Plus</span> </button>
          </li>
          <li class="menu-item">
            <button type="button" class="menu-btn"> <i class="fa fa-envelope"></i> <span class="menu-text">Email</span> </button>
          </li>
        </menu>
      </li>
    </menu>
  </li>
  <li class="menu-separator"></li>
  <li class="menu-item">
    <button type="button" class="menu-btn"> <i class="fa fa-download"></i> <span class="menu-text">Save</span> </button>
  </li>
  <li class="menu-item">
    <button type="button" class="menu-btn"> <i class="fa fa-edit"></i> <span class="menu-text">Rename</span> </button>
  </li>
  <li class="menu-item">
    <button type="button" class="menu-btn"> <i class="fa fa-trash"></i> <span class="menu-text">Delete</span> </button>
  </li>
</menu>
  
  <script>
  var menu = document.querySelector('.menu');

function showMenu(x, y){
    menu.style.left = x + 'px';
    menu.style.top = y + 'px';
    if(device == "keyboard") menu.classList.add('show-menu');
}

function hideMenu(){
    menu.classList.remove('show-menu');
}

function onContextMenu(e){
    e.preventDefault();
    showMenu(e.pageX, e.pageY);
    document.addEventListener('click', onClick, false);
}

function onClick(e){
    hideMenu();
    document.removeEventListener('click', onClick);
}

document.addEventListener('contextmenu', onContextMenu, false);

  </script>
  
  
  <script>
  
  var start = 0;
  var start_unos = 0;
  var bool = 0;
  var time_kraj_unosa = 0;
  var time_kraj_copy = 0;
  var time_kraj_paste = 0;
  var do_unosa = 0;
  var rightMouseClicked = false;
  var za_ispis = "";
  var user_log = "";
  var count = 0;
  var flag_input = 0;
  var flag_action = 0;
  var zadatak = 0;
  var rijesenje = "";
  var tekst_prepis = "99";
  var clipboard = "";
  var recenice = [
				"Today is a nice day", 
				"This is short",
				"I'm halfway there",
				"A little bit more",
				"This is the last sentence",
				"KRAJ ZADATKA"];
  
  //document.onkeydown = keydown; 
  
  var device = localStorage.getItem('device');

  var student_id = localStorage.getItem('student_id');
  
  function loggaj(){
  console.log("tu sam")
  user_log = user_log + document.getElementById("Task_output2").value + "\n";
  
  if(bool == 0) {
  //do unosa, za racun
  do_unosa = performance.now();
  start_unos = performance.now();
  console.log("počinjem log");
  }
  bool = 1;
  if(document.getElementById("Task_output2").value == tekst_prepis){
	//vrijem unosa
	time_kraj_unosa = performance.now() - start_unos;
	console.log("počinjem log");
  }
 
 }
  
  function downloadResults(string,type) {
	var blob = new Blob([string], {type: "text/plain;charset=utf-8"});
	var date = new Date();
	var currentDate = [date.getFullYear(), date.getMonth(), date.getDate()].join('');
	var currentTime = [date.getHours(), date.getMinutes(), date.getSeconds()].join('');
	var fileName = type + "_" + student_id + "_" + device + "_" + currentDate + "_" + currentTime + ".csv";
	saveAs(blob, fileName);
}
  
  function kopiraj(){
  if(flag_action == 1 && device == "keyboard") {clipboard = window.getSelection().toString();
  document.getElementById("result").innerHTML = "Copied";
  time_kraj_copy = performance.now() - (time_kraj_unosa + do_unosa);
  console.log(time_kraj_copy);
  console.log("done copy");
  console.log("počinjem log");
  }
  }
  
  function pasteaj(){
  if(device == "keyboard" && clipboard == rijesenje){ 
  time_kraj_paste = performance.now() - (time_kraj_copy + time_kraj_unosa + do_unosa);
  check();
  document.getElementById("result").innerHTML = "Pasted";
  console.log("done paste");
  }
  }
  

  
  function zadatak_cpaste(tekst_zad){
  zadatak = 1;
  document.getElementById("ime_zad").innerHTML = "Akcija: Paste";
  tekst_prepis = tekst_zad;
  var word_array = tekst_zad.split(" ");
  var rnd_word = word_array[Math.floor(Math.random() * word_array.length)];
  rijesenje = rnd_word;
  //za tipkovnicu i mis
  if(device == "keyboard") {
  document.getElementById("opis_zad").innerHTML = "Napiši rečenicu \"" + tekst_zad +"\", potom označi riječ \"" + rnd_word + "\" - Zatim kopiraj riječ "+ rnd_word +" kopiraj kraticom ctr + c, označi donji prostor i zalijepi kraticom ctrl + v.";
  document.getElementById("Task_output2").style.visibility = "visible";
  //document.getElementById("Task_input").style.display = "none";
  document.getElementById("editor").style.display = "none";
  document.getElementById("navigator").style.display = "none";
  
  }
  //za tablet
  if(device == "tablet") document.getElementById("opis_zad").innerHTML = "Napiši rečenicu \"" + tekst_zad +"\", potom označi riječ \"" + rnd_word + "\" - kopiraj ju izradom geste u obliku kruga i onda odabirom donjeg prostora i rađenje geste check.";
  }
  
  
  
  function zad_focus(){
  flag_action = 1;
  
  }
  
  function zad_blur(){
  if(device == "tablet") flag_action = 0;
  }
  
  function set_zad(){
  bool = 0;
  var flag_input = 0;
  var flag_action = 0;
  var rijesenje = "";
  var tekst_prepis = "random text";
  var clipboard = "";
  document.getElementById("Task_input").value = "";
  document.getElementById("Task_output").value = "";
  document.getElementById("Task_output2").value = "";
  for(var i = 0; i< 150; i++){
	editorElement.editor.undo();
  }
  
  zadatak_cpaste(recenice[count]);
  count++;
  
	
  }
  
  
  function check(){
    console.log(document.getElementById("Task_output2").value);
	console.log(tekst_prepis);
	console.log(clipboard);
	console.log(rijesenje);
	
	if(document.getElementById("Task_output2").value == tekst_prepis && document.getElementById("Task_input").value == rijesenje || clipboard == rijesenje ||document.getElementById("Task_output").value == tekst_prepis && document.getElementById("Task_input").value == rijesenje ){
	
	//time_kraj_paste = performance.now() - start;
    //start = time_kraj_paste;
	//console.log("done paste");
	set_zad();
	za_ispis = za_ispis + "Zadatak: " + (count - 1) + ", vrijeme: kraj unosa: " + time_kraj_unosa / 1000 + "s, kraj copy: " + time_kraj_copy / 1000 +"s, kraj paste: " + time_kraj_paste / 1000 + "s\n";
	if (count == 6){
		downloadResults(za_ispis, "Time_Log");
		downloadResults(user_log, "User_Log");
		document.getElementById("ime_zad").innerHTML = "";
		document.getElementById("opis_zad").innerHTML = "Gotovi ste s modalitetom rada";
	}
	
	}
  }
  
  </script>
  
  <div style='text-align: center;' id="Task_form">
  
	<h1 class="tekst" id="ime_zad"> Ime Zadatka</h1>
	<h3 class="tekst" id="opis_zad"> Opis Zadatka</h3>
	<br> <br>
	<div  id="action_part">
		<h3 id="Task_output" contenteditable="true" tabindex="0">
		</h3>
		<input class = "form-control" type="text" id="Task_output2" onfocus="zad_focus()" onblur="zad_blur()" oninput="loggaj()" style="visibility:hidden;" >
		<br class="tekst">
		<br class="tekst">
		<br class="tekst">
		<h4 class="tekst">Ovdje zalijepiti:</h4> <br> <br>
		<input class = "form-control" type="text"id="Task_input" onfocus="zad_focus()" oninput="check()" ><br>
	</div>
	<h3 class="tekst" id='result' >Result: </h3>
	<br> <br> <br>
	<div>
  <nav id="navigator">
    <div class="button-div">
      <button id="undo" class="nav-btn btn-fab-mini btn-lightBlue" disabled>
        <img src="./assets/undo.svg">
      </button>
      <button style="visibility:hidden;" id="redo" class="nav-btn btn-fab-mini btn-lightBlue" disabled>
        <img src="./assets/redo.svg"> 
      </button>
    </div>
    <select id="language"></select>
  </nav>
  <div id="editor" touch-action="none"></div>
</div>
  </div>
  <canvas id="gestures_canvas" height="200" width="200">
  </canvas>
  <script type="text/javascript" src="./gestures.js" ></script>
    <script type="text/javascript">
function callback(name)
{
	//document.getElementById("result").innerHTML = "Result: " + name;
	console.log("===========");
	console.log(zadatak);
	console.log(flag_input);
	console.log(device);
	console.log(name);
	console.log(flag_action);
	console.log(rightMouseClicked);
	console.log("===========");
	user_log = user_log + name + "\n";
	if ( device == "tablet" && name == "Paste" && rightMouseClicked == true){
	document.getElementById("result").innerHTML = "Tried to paste, but nothing in clipboard";
	}
	
	
	if (zadatak == 1 && flag_input == 1 && device == "tablet" && name == "Paste" && flag_action == 1 && rightMouseClicked == true){
		document.getElementById("Task_input").value = clipboard;
		time_kraj_paste = performance.now() - (time_kraj_copy + time_kraj_unosa + do_unosa);
        document.getElementById("result").innerHTML = "Pasted";
		
		if(document.getElementById("Task_input").value == rijesenje) {
		//time_kraj_paste = performance.now() - start;
        //start = time_kraj_paste;
		set_zad();
		za_ispis = za_ispis + "Zadatak: " + (count - 1) + ", vrijeme: kraj unosa: " + time_kraj_unosa / 1000 + "s, kraj copy: " + time_kraj_copy / 1000 +"s, kraj paste: " + time_kraj_paste / 1000 + "s\n";
		if (count == 6){
			downloadResults(za_ispis, "Time_Log");
			downloadResults(user_log, "User_Log");
		}
			}
		}
	
	
	if(rightMouseClicked == true && name == "Copy" && clipboard == rijesenje){
	document.getElementById("result").innerHTML = "Copied";
	flag_input = 1;
	time_kraj_copy = performance.now() - (time_kraj_unosa + do_unosa);
	console.log(time_kraj_copy);
	console.log("done copy");
	console.log("počinjem log");
	}
	else if(rightMouseClicked == true && name == "Copy"){
	document.getElementById("result").innerHTML = "Tried to copy, but empty selection";
	}
	
}

 //bruv ovo ce valjda spasit sve
var p = document.getElementById("Task_output");
var old = p.innerHTML;
var input = document.querySelector('input');

p.addEventListener('blur', () => {
   highlight(select()); // save the selection
})
p.addEventListener('focus', () => {
  restore(); // restore the selection
})

function highlight(r) {
  if (!r) return;

  var extracted = r.extractContents();
  
  el = document.createElement('span');
  el.id = "selekcija";
  el.appendChild(extracted);
  r.insertNode(el)
}

function select() {
  
  if (window.getSelection) {
	clipboard = window.getSelection().toString();
    sel = window.getSelection();
	
    if (sel.getRangeAt && sel.rangeCount) {
      return sel.getRangeAt(0);
    }
  } else if (document.selection && document.selection.createRange) {
    return document.selection.createRange();
  }
  return null;
}

function restore() {
  p.innerHTML = old;
}
  // ja se nadam

var gest = new gestures({
	debug: true,
	draw: true,
	drawColor: "#000000",
	drawWidth: 5,
	autoTrack: true,
	allowRotation: true,
	inverseShape: true,
	points: 33
});

gest.addGesture("Line", [
	{x: 0, y: 0},
	{x: 0, y: 100}
], callback);


gest.addGesture("Paste", [
	{x: 0, y: 0},
	{x: 50, y: 50},
	{x: 100, y: 0},
], callback);

var x = 0;
var y = -100;
var circle = [];
var totalPoints = 72;
var step = (Math.PI*2)/totalPoints;

for(var angle = 1; angle < totalPoints; angle++)
{
	var newX = x*Math.cos(angle*step)-y*Math.sin(angle*step);
	var newY = y*Math.cos(angle*step)+x*Math.sin(angle*step);
	var point = {x: newX, y: newY};
	circle.push(point);
}

gest.addGesture("Copy", circle, callback)
</script>
<script>
/*
	function validate(evt) {
   var theEvent = evt || window.event;
   var key = theEvent.charCode || theEvent.which;
	
   if(key >= 32 && (theEvent.ctrlKey === undefined || !theEvent.ctrlKey)) {
		if(theEvent.preventDefault) theEvent.preventDefault();
		else theEvent.returnValue = false;
	}
	
	
	}*/
  var editorElement = document.getElementById('editor');

  var languageElement = document.getElementById('language');
  var undoElement = document.getElementById('undo');
  var redoElement = document.getElementById('redo');
  var resultElement = document.getElementById('export-result');
  
  editorElement.addEventListener('changed', function (event) {
    undoElement.disabled = !event.detail.canUndo;
    redoElement.disabled = !event.detail.canRedo;
  });

  editorElement.addEventListener('loaded', function (evt) {
    /**
     * Retrieve the list of available recognition languages
     * @param {Object} The editor recognition parameters
     */
    var currentLanguage = evt.target.editor.configuration.recognitionParams.v4.lang;
    var res = MyScript.getAvailableLanguageList();

    if (languageElement.options.length === 0) {
      Object.keys(res.result).forEach(function (key) {
        var selected = currentLanguage === key;
        languageElement.options[languageElement.options.length] = new Option(res.result[key], key, selected, selected);
      });
    }
  });

  languageElement.addEventListener('change', function (e) {
    var configuration = editorElement.editor.configuration;
    //The path to the language depend of the version of API you are using.
    configuration.recognitionParams.v4.lang = e.target.value;
    editorElement.editor.configuration = configuration;
  });

  undoElement.addEventListener('click', function () {
    editorElement.editor.undo();
  });
  redoElement.addEventListener('click', function () {
    editorElement.editor.redo();
  });
	
	editorElement.addEventListener('exported', function (evt) {
        if (evt.detail) {
		
		if(bool == 0) do_unosa = performance.now();
		var export_string = JSON.stringify(evt.detail);
		var num = export_string.search('"text/plain"') + 14;
		var plain_text = export_string.slice(num);
		plain_text = plain_text.substring(0, plain_text.lastIndexOf("\""));
		console.log(plain_text);
		
		document.getElementById("Task_output").innerHTML = plain_text;
		console.log(tekst_prepis);
		console.log(bool);
		if(bool == 1) {
		//do unosa, za racun
			
			start_unos = performance.now();
			console.log("počinjem log_tablet");
			
			bool = 2;
		}
		if (bool == 0) bool = 1;
		console.log(tekst_prepis + " vs " + plain_text);
		if(tekst_prepis == plain_text){
		//vrijeme unosa
			time_kraj_unosa = performance.now() - start_unos;
			console.log("počinjem log");
		}
		
		
		user_log = user_log + plain_text + "\n";
		old = plain_text;
        } else {
		  document.getElementById("Task_output").innerHTML = '';
		  old = "";
        }
      });
  /**
   * Attach an editor to the document
   * @param {Element} The DOM element to attach the ink paper
   * @param {Object} The recognition parameters
   */
  MyScript.register(editorElement, {
    recognitionParams: {
      type: 'TEXT',
      protocol: 'WEBSOCKET',
      apiVersion: 'V4',
      server: {
        scheme: 'https',
        host: 'webdemoapi.myscript.com',
        applicationKey: '515131ab-35fa-411c-bb4d-3917e00faf60',
        hmacKey: '54b2ca8a-6752-469d-87dd-553bb450e9ad'
      },
      v4: {
        text: {
              guides: {
                enable: true
              },
              smartGuide: false
            }

      }
    }
  });

  window.addEventListener('resize', function () {
    editorElement.editor.resize();
  });
  //bruh samo mouse ups and downs
  function handleMouseDown(e) {
  //e.button describes the mouse button that was clicked
  // 0 is left, 1 is middle, 2 is right
  if (e.button === 2) {
    rightMouseClicked = true;
  } else if (e.button === 0) {  
    //Do something if left button was clicked and right button is still pressed
    if (rightMouseClicked) {
      console.log('hello');
      //code
    }
  }
  console.log(rightMouseClicked);
}

function handleMouseUp(e) {
  if (e.button === 2) {
    rightMouseClicked = false;
  }
  console.log(rightMouseClicked);
}

document.addEventListener('mousedown', handleMouseDown);
document.addEventListener('mouseup', handleMouseUp);

  set_zad();
</script>

	</div>
</body>



</html>